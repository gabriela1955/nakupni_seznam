<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>N√°kupn√≠ seznam</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{
      --muted:#94a3b8;--text:#e5e7eb;--line:rgba(148,163,184,.22);
      --card:rgba(17,27,46,.78);--bg:linear-gradient(180deg,#060b16,#0b1220 35%);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}

    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);background:rgba(6,11,22,.72);border-bottom:1px solid var(--line)}
    .wrap{max-width:860px;margin:0 auto;padding:10px 12px}
    .topbar{display:flex;gap:8px;align-items:center}
    .brand{font-weight:700;font-size:14px;white-space:nowrap}
    .select{padding:9px 10px;border-radius:12px;border:1px solid var(--line);background:rgba(17,27,46,.92);color:var(--text)}
    .search{flex:1;min-width:120px;padding:9px 10px;border-radius:12px;border:1px solid var(--line);background:rgba(17,27,46,.92);color:var(--text)}
    .iconbtn{width:38px;height:38px;border-radius:12px;border:1px solid var(--line);background:rgba(17,27,46,.92);color:var(--text);display:grid;place-items:center}
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab{padding:7px 10px;border-radius:12px;border:1px solid var(--line);background:rgba(17,27,46,.6);color:var(--muted);cursor:pointer;font-size:12px}
    .tab.on{color:var(--text);border-color:rgba(34,197,94,.35);background:rgba(17,27,46,.92)}

    .cards{display:flex;flex-direction:column;gap:10px;padding:10px 0 54px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card h3{margin:0;padding:10px 12px;font-size:14px;border-bottom:1px solid var(--line)}
    .list{list-style:none;margin:0;padding:0}
    .item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-top:1px solid var(--line)}
    .item:first-child{border-top:none}
    .chk{width:22px;height:22px;border-radius:6px;border:1px solid var(--line);display:grid;place-items:center;background:rgba(6,11,22,.35)}
    .chk.on{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.45)}
    .label{flex:1;line-height:1.25}
    .label.done{text-decoration:line-through;color:rgba(229,231,235,.55)}
    .x{border:none;background:transparent;color:rgba(148,163,184,.85);font-size:18px;padding:0 6px;cursor:pointer}

    .panel{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;margin-top:10px}
    .panel h2{margin:0;padding:10px 12px;font-size:14px;border-bottom:1px solid var(--line)}
    .inner{padding:10px 12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(17,27,46,.92);color:var(--text)}
    .btn.primary{border-color:rgba(34,197,94,.45)}
    .tiny{font-size:12px;color:var(--muted)}
    .recipe{padding:10px 0;border-top:1px solid var(--line)}
    .recipe:first-child{border-top:none}
    .rhead{display:flex;gap:10px;align-items:flex-start}
    .rchk{margin-top:2px}
    details{margin-top:6px}
    summary{cursor:pointer;color:var(--text)}
    .meta{font-size:12px;color:var(--muted);margin-top:2px}
    .ingline{font-size:12px;color:var(--muted);line-height:1.35;margin-top:6px}
    ol{margin:6px 0 0 18px;padding:0}
    li{margin:4px 0}

    .footerbar{position:fixed;left:0;right:0;bottom:0;background:rgba(6,11,22,.82);backdrop-filter:blur(10px);border-top:1px solid var(--line)}
    .footerbar .wrap{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 12px}
    .count{color:var(--muted);font-size:12px}

    dialog{border:none;border-radius:16px;padding:0;background:rgba(17,27,46,.98);color:var(--text);width:min(420px,92vw)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .dlg{padding:12px}
    .dlg h3{margin:0 0 8px;font-size:14px}
    .dlg .btn{width:100%;margin-top:6px}

    @media print{
      header,.footerbar,#planControls{display:none !important;}
      body{background:white;color:black}
      .card,.panel{background:white;border:1px solid #ddd}
      .label.done{text-decoration:line-through;color:#666}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">üß∫ Seznam</div>
        <select id="listSel" class="select" aria-label="Seznam"></select>
        <input id="q" class="search" placeholder="Hledat‚Ä¶" aria-label="Hledat" />
        <button class="iconbtn" id="addBtn" title="P≈ôidat">Ôºã</button>
        <button class="iconbtn" id="topMoreBtn" title="V√≠ce">‚ãØ</button>
      </div>
      <div class="tabs">
        <button class="tab on" id="tabList">Seznam</button>
        <button class="tab" id="tabPlan">J√≠deln√≠ƒçek</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="viewList">
      <div id="cards" class="cards"></div>
    </div>

    <div id="viewPlan" style="display:none">
      <section class="panel" id="planControls">
        <h2>J√≠deln√≠ƒçek</h2>
        <div class="inner">
          <div class="row" style="margin-bottom:10px">
            <select id="planSel" class="select" style="flex:1" aria-label="Pl√°n"></select>
          </div>
          <div class="row" style="margin-bottom:10px">
            <button class="btn primary" id="genSelectedBtn">Vytvo≈ôit seznam z vybran√Ωch j√≠del</button>
            <button class="btn" id="appendSelectedBtn">P≈ôidat vybran√° j√≠dla do seznamu</button>
          </div>
          <div class="tiny">Vyber jedno nebo v√≠ce j√≠del n√≠≈æe. ‚ÄûVytvo≈ôit‚Äú p≈ôep√≠≈°e aktu√°ln√≠ seznam, ‚ÄûP≈ôidat‚Äú jen dopln√≠ chybƒõj√≠c√≠ polo≈æky.</div>
        </div>
      </section>

      <section class="panel">
        <h2>Recepty (klikni pro postup)</h2>
        <div class="inner" id="recipesBox"></div>
      </section>
    </div>
  </main>

  <div class="footerbar">
    <div class="wrap">
      <div class="count" id="countLine"></div>
      <div class="row">
        <button class="iconbtn" id="hideDoneBtn" title="Skr√Ωt hotov√© / zobrazit hotov√©">üôà</button>
        <button class="iconbtn" id="markAllBtn" title="Oznaƒçit v≈°e / odznaƒçit v≈°e">‚úì</button>
        <button class="iconbtn" id="moreBtn" title="Dal≈°√≠ akce">‚ãØ</button>
      </div>
    </div>
  </div>

  <dialog id="dlgAdd">
    <div class="dlg">
      <h3>P≈ôidat polo≈æku</h3>
      <input id="newName" class="search" placeholder="N√°zev polo≈æky" />
      <div style="height:8px"></div>
      <select id="newCat" class="select" style="width:100%"></select>
      <div style="height:8px"></div>
      <button class="btn primary" id="saveBtn">Ulo≈æit</button>
      <button class="btn" id="cancelBtn">Zru≈°it</button>
    </div>
  </dialog>

  <dialog id="dlgMore">
    <div class="dlg">
      <h3>Dal≈°√≠ akce</h3>
      <button class="btn" id="renameBtn">P≈ôejmenovat seznam</button>
      <button class="btn" id="shareBtn">Sd√≠let seznam</button>
      <button class="btn" id="printBtn">Tisk/PDF</button>
      <button class="btn" id="resetBtn">Reset aktu√°ln√≠ho seznamu</button>
      <button class="btn" id="closeMoreBtn">Zav≈ô√≠t</button>
    </div>
  </dialog>

  <script>
    const APP_DATA = {"plans": [{"id": "week1", "name": "T√Ωden 1 (rychl√© & dietn√≠)", "recipes": [{"id": "r1", "name": "Ku≈ôec√≠ prsa + quinoa + peƒçen√° zelenina", "time": "25‚Äì35 min", "servings": "2‚Äì3 porce", "ingredients": [{"category": "Maso / ryby / b√≠lkoviny", "name": "Ku≈ôec√≠ prsa (cca 700 g)"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Quinoa ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Cuketa ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Paprika ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Mrkev ‚Äì 4 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["Troubu p≈ôedeh≈ôej na 200 ¬∞C. Zeleninu nakr√°jej, prom√≠chej s olivov√Ωm olejem, sol√≠ a pep≈ôem. Peƒç 20‚Äì25 min.", "Quinou propl√°chni, uva≈ô podle n√°vodu (cca 12‚Äì15 min), nech doj√≠t pod pokliƒçkou.", "Ku≈ôe osol/opep≈ôi, opeƒç na p√°nvi 5‚Äì7 min z ka≈æd√© strany. Nech 2 min odpoƒçinout a nakr√°jej.", "Nad√°vkuj do krabiƒçek: quinoa + zelenina + ku≈ôe."], "tips": "P≈ôidej citr√≥n nebo ho≈ôƒçici do z√°livky."}, {"id": "r2", "name": "Losos + r√Ω≈æe + okurkov√Ω sal√°t (jogurtov√Ω)", "time": "20‚Äì25 min", "servings": "2 porce", "ingredients": [{"category": "Maso / ryby / b√≠lkoviny", "name": "Losos ‚Äì 2 filety"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "R√Ω≈æe (basmati / natural) ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Sal√°tov√° okurka ‚Äì 3 ks"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "B√≠l√Ω jogurt / skyr ‚Äì 3 balen√≠"}, {"category": "Ovoce", "name": "Citr√≥ny ‚Äì 2 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Kopr (ƒçerstv√Ω/su≈°en√Ω)"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["R√Ω≈æi uva≈ô podle n√°vodu.", "Lososa osol/opep≈ôi, opeƒç 3‚Äì4 min k≈Ø≈æ√≠ dol≈Ø, otoƒç a dop√©kaj 2‚Äì3 min (nebo peƒç 10‚Äì12 min na 200 ¬∞C).", "Okurku nakr√°jej. Sm√≠chej jogurt + citron + kopr + s≈Øl/pep≈ô a prom√≠chej s okurkou.", "Krabiƒçkuj: r√Ω≈æe + losos, sal√°t zvl√°≈°≈•."], "tips": "Sal√°t dej do mal√© krabiƒçky, a≈• se r√Ω≈æe nerozmoƒç√≠."}, {"id": "r3", "name": "ƒåoƒçkov√Ω sal√°t s fetou", "time": "10‚Äì15 min", "servings": "2‚Äì3 porce", "ingredients": [{"category": "Lu≈°tƒõniny / hotov√© produkty", "name": "ƒåoƒçka v konzervƒõ ‚Äì 1 ks"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Feta / balk√°nsk√Ω s√Ωr ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Rajƒçata ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Paprika ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Jarn√≠ cibulka ‚Äì 1 svazek"}, {"category": "Ovoce", "name": "Citr√≥ny ‚Äì 2 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["ƒåoƒçku slij a propl√°chni.", "Zeleninu nakr√°jej, p≈ôidej ƒçoƒçku.", "Z√°livka: olivov√Ω olej + citron + s≈Øl/pep≈ô. Prom√≠chej.", "Navrch rozdrob fetu."], "tips": "Vydr≈æ√≠ 2‚Äì3 dny v lednici."}, {"id": "r4", "name": "Tortilla wrap (tu≈à√°k + jogurt + sal√°t)", "time": "10 min", "servings": "2 wrapy", "ingredients": [{"category": "P≈ô√≠lohy / peƒçivo", "name": "Celozrnn√© tortilly ‚Äì 1 balen√≠"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Tu≈à√°k ve vlastn√≠ ≈°≈•√°vƒõ ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Listov√Ω sal√°t / rukola ‚Äì 2 balen√≠"}, {"category": "Zelenina", "name": "Rajƒçata ‚Äì 4 ks"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "B√≠l√Ω jogurt / skyr ‚Äì 3 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Ho≈ôƒçice"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["Tu≈à√°ka slij, prom√≠chej s jogurtem, ho≈ôƒçic√≠, sol√≠ a pep≈ôem.", "Na tortillu dej sal√°t, rajƒçe a tu≈à√°kovou smƒõs.", "Zatoƒç a zabal. Do pr√°ce ide√°lnƒõ zabal do pap√≠ru/folie."], "tips": "P≈ôidej okurku nebo jarn√≠ cibulku."}, {"id": "r5", "name": "Zeleninov√° pol√©vka (rychl√°)", "time": "20‚Äì30 min", "servings": "3‚Äì4 porce", "ingredients": [{"category": "Zelenina", "name": "Mrkev ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Cuketa ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Cibule / p√≥rek ‚Äì 1 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Celozrnn√Ω chl√©b / peƒçivo ‚Äì 1 balen√≠"}], "steps": ["Cibuli/p√≥rek kr√°tce orestuj na tro≈°e oleje.", "P≈ôidej nakr√°jenou zeleninu, zalij vodou/v√Ωvarem, osol a opep≈ôi.", "Va≈ô 15‚Äì20 min do zmƒõknut√≠. Pod√°vej s peƒçivem."], "tips": "ƒå√°st rozmixuj na kr√©m."}, {"id": "r6", "name": "Sal√°t s vejcem / tu≈à√°kem", "time": "12‚Äì15 min", "servings": "2 porce", "ingredients": [{"category": "Maso / ryby / b√≠lkoviny", "name": "Vejce ‚Äì 10 ks"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Tu≈à√°k ve vlastn√≠ ≈°≈•√°vƒõ ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Listov√Ω sal√°t / rukola ‚Äì 2 balen√≠"}, {"category": "Zelenina", "name": "Rajƒçata ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Sal√°tov√° okurka ‚Äì 3 ks"}, {"category": "Ovoce", "name": "Citr√≥ny ‚Äì 2 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["Vejce uva≈ô natvrdo (9‚Äì10 min), zchlaƒè a oloupej.", "Sm√≠chej sal√°t, okurku, rajƒçe. P≈ôidej vejce nebo tu≈à√°ka.", "Z√°livka: olivov√Ω olej + citron + s≈Øl/pep≈ô (dej do mal√© krabiƒçky)."], "tips": "Super i jako rychl√° veƒçe≈ôe."}, {"id": "r7", "name": "Restovan√° zelenina + tofu (s√≥jov√°)", "time": "12‚Äì15 min", "servings": "2 porce", "ingredients": [{"category": "Zelenina", "name": "Mra≈æen√° zelenina ‚Äì 1 balen√≠"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Tofu ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S√≥jov√° om√°ƒçka"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}], "steps": ["Restuj mra≈æenou zeleninu na tro≈°e oleje 6‚Äì8 min.", "P≈ôidej tofu na kostky, op√©kej 3‚Äì4 min.", "Zak√°pni s√≥jovou om√°ƒçkou a prohoƒè."], "tips": "S p≈ô√≠lohou r√Ω≈æe je to plnohodnotn√Ω obƒõd."}, {"id": "r8", "name": "Cottage/tvaroh + zelenina + sem√≠nka (svaƒçina)", "time": "5 min", "servings": "1 porce", "ingredients": [{"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Cottage s√Ωr ‚Äì 2 balen√≠"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Tvaroh mƒõkk√Ω ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Paprika ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Sal√°tov√° okurka ‚Äì 3 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Sem√≠nka (sluneƒçnice / d√Ωnƒõ) ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["Dej cottage/tvaroh do misky.", "P≈ôidej zeleninu a sem√≠nka, osol/opep≈ôi."], "tips": "Na sladko: skyr + ovoce + o≈ôechy."}, {"id": "r9", "name": "Zeleninov√° omeleta", "time": "10‚Äì12 min", "servings": "1‚Äì2 porce", "ingredients": [{"category": "Maso / ryby / b√≠lkoviny", "name": "Vejce ‚Äì 10 ks"}, {"category": "Zelenina", "name": "Cuketa ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Paprika ‚Äì 4 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}], "steps": ["Kr√°tce orestuj zeleninu na p√°nvi.", "Vejce roz≈°lehej se sol√≠/pep≈ôem, nalij na zeleninu.", "Op√©kej na m√≠rn√©m ohni 5‚Äì7 min."], "tips": "V√Ωborn√© i studen√© do krabiƒçky."}, {"id": "r10", "name": "Sn√≠danƒõ/svaƒçiny (skyr + vloƒçky + ovoce)", "time": "5 min", "servings": "1 porce", "ingredients": [{"category": "Ml√©ƒçn√© v√Ωrobky", "name": "B√≠l√Ω jogurt / skyr ‚Äì 3 balen√≠"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Ovesn√© vloƒçky ‚Äì 1 balen√≠"}, {"category": "Ovoce", "name": "Jablka ‚Äì 4 ks"}, {"category": "Ovoce", "name": "Ban√°ny ‚Äì 4 ks"}, {"category": "Ovoce", "name": "Ovoce do jogurtu (bor≈Øvky / jahody) ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "O≈ôechy ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Ara≈°√≠dov√© m√°slo (100 %)"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Kn√§ckebrot ‚Äì 1 balen√≠"}, {"category": "Lu≈°tƒõniny / hotov√© produkty", "name": "Hummus ‚Äì 1 balen√≠"}, {"category": "Voliteln√©", "name": "Ho≈ôk√° ƒçokol√°da"}, {"category": "Voliteln√©", "name": "Proteinov√© tyƒçinky (2‚Äì3 ks)"}], "steps": ["Skyr/jogurt dej do krabiƒçky, p≈ôidej vloƒçky, ovoce a o≈ôechy.", "Volitelnƒõ: l≈æiƒçka ara≈°√≠dov√©ho m√°sla nebo p√°r kostiƒçek ho≈ôk√© ƒçokol√°dy."], "tips": "Na cesty: kn√§ckebrot + hummus."}]}, {"id": "week2", "name": "T√Ωden 2 (≈°ablona ‚Äì dopln√≠≈°)", "recipes": [{"id": "w2r1", "name": "(dopl≈à si recepty)", "time": "", "servings": "", "ingredients": [{"category": "Zelenina", "name": "(dopl≈à si polo≈æky)"}], "steps": ["(dopl≈à)"], "tips": ""}]}], "defaultLists": [{"id": "list-week1", "name": "T√Ωden 1", "planId": "week1", "items": [{"category": "Maso / ryby / b√≠lkoviny", "name": "Ku≈ôec√≠ prsa (cca 700 g)"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Quinoa ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Cuketa ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Paprika ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Mrkev ‚Äì 4 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Olivov√Ω olej"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S≈Øl, pep≈ô"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Losos ‚Äì 2 filety"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "R√Ω≈æe (basmati / natural) ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Sal√°tov√° okurka ‚Äì 3 ks"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "B√≠l√Ω jogurt / skyr ‚Äì 3 balen√≠"}, {"category": "Ovoce", "name": "Citr√≥ny ‚Äì 2 ks"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Kopr (ƒçerstv√Ω/su≈°en√Ω)"}, {"category": "Lu≈°tƒõniny / hotov√© produkty", "name": "ƒåoƒçka v konzervƒõ ‚Äì 1 ks"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Feta / balk√°nsk√Ω s√Ωr ‚Äì 1 balen√≠"}, {"category": "Zelenina", "name": "Rajƒçata ‚Äì 4 ks"}, {"category": "Zelenina", "name": "Jarn√≠ cibulka ‚Äì 1 svazek"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Celozrnn√© tortilly ‚Äì 1 balen√≠"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Tu≈à√°k ve vlastn√≠ ≈°≈•√°vƒõ ‚Äì 2 ks"}, {"category": "Zelenina", "name": "Listov√Ω sal√°t / rukola ‚Äì 2 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Ho≈ôƒçice"}, {"category": "Zelenina", "name": "Cibule / p√≥rek ‚Äì 1 ks"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Celozrnn√Ω chl√©b / peƒçivo ‚Äì 1 balen√≠"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Vejce ‚Äì 10 ks"}, {"category": "Zelenina", "name": "Mra≈æen√° zelenina ‚Äì 1 balen√≠"}, {"category": "Maso / ryby / b√≠lkoviny", "name": "Tofu ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "S√≥jov√° om√°ƒçka"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Cottage s√Ωr ‚Äì 2 balen√≠"}, {"category": "Ml√©ƒçn√© v√Ωrobky", "name": "Tvaroh mƒõkk√Ω ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Sem√≠nka (sluneƒçnice / d√Ωnƒõ) ‚Äì 1 balen√≠"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Ovesn√© vloƒçky ‚Äì 1 balen√≠"}, {"category": "Ovoce", "name": "Jablka ‚Äì 4 ks"}, {"category": "Ovoce", "name": "Ban√°ny ‚Äì 4 ks"}, {"category": "Ovoce", "name": "Ovoce do jogurtu (bor≈Øvky / jahody) ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "O≈ôechy ‚Äì 1 balen√≠"}, {"category": "O≈ôechy / sem√≠nka / dochucovadla", "name": "Ara≈°√≠dov√© m√°slo (100 %)"}, {"category": "P≈ô√≠lohy / peƒçivo", "name": "Kn√§ckebrot ‚Äì 1 balen√≠"}, {"category": "Lu≈°tƒõniny / hotov√© produkty", "name": "Hummus ‚Äì 1 balen√≠"}, {"category": "Voliteln√©", "name": "Ho≈ôk√° ƒçokol√°da"}, {"category": "Voliteln√©", "name": "Proteinov√© tyƒçinky (2‚Äì3 ks)"}]}, {"id": "list-week2", "name": "T√Ωden 2", "planId": "week2", "items": [{"category": "Zelenina", "name": "(dopl≈à si polo≈æky)"}]}, {"id": "list-custom", "name": "Vlastn√≠", "planId": null, "items": []}]};

    const STORAGE = {
      lists: "ns_lists_v22",
      current: "ns_current_list_v22",
      prefs: "ns_prefs_v22",
      itemsPrefix: "ns_items_v22__",
      plan: "ns_plan_v22",
      selected: "ns_selected_recipes_v22__"
    };

    const state = {
      lists: [],
      currentListId: null,
      items: [],
      hideDone: false,
      view: "list",
      currentPlanId: APP_DATA.plans[0]?.id || null,
      selectedRecipes: new Set(),
    };

    function uid() { return crypto.randomUUID(); }
    function normalizeKey(s){ return (s||"").toLowerCase().replace(/\s+/g," ").trim(); }
    function itemsKey(listId){ return STORAGE.itemsPrefix + listId; }
    function selectedKey(planId){ return STORAGE.selected + planId; }

    function load(){
      const prefRaw = localStorage.getItem(STORAGE.prefs);
      if (prefRaw) { try { const p = JSON.parse(prefRaw); state.hideDone = !!p.hideDone; } catch {} }

      const listsRaw = localStorage.getItem(STORAGE.lists);
      if (listsRaw){ try { state.lists = JSON.parse(listsRaw); } catch { state.lists = structuredClone(APP_DATA.defaultLists); } }
      else { state.lists = structuredClone(APP_DATA.defaultLists); }

      state.currentListId = localStorage.getItem(STORAGE.current) || state.lists[0]?.id || "list-week1";

      const planRaw = localStorage.getItem(STORAGE.plan);
      if (planRaw) state.currentPlanId = planRaw;

      loadItemsForCurrent();
      loadSelectedForPlan();
    }

    function persistLists(){
      localStorage.setItem(STORAGE.lists, JSON.stringify(state.lists));
      localStorage.setItem(STORAGE.current, state.currentListId);
      localStorage.setItem(STORAGE.prefs, JSON.stringify({hideDone: state.hideDone}));
      localStorage.setItem(STORAGE.plan, state.currentPlanId || "");
    }

    function persistItems(){
      localStorage.setItem(itemsKey(state.currentListId), JSON.stringify(state.items));
      persistLists();
    }

    function loadItemsForCurrent(){
      const raw = localStorage.getItem(itemsKey(state.currentListId));
      if (raw){ try { state.items = JSON.parse(raw); return; } catch {} }
      const meta = state.lists.find(l=>l.id===state.currentListId);
      const defaults = meta?.items || [];
      state.items = defaults.map(x => ({...x, done:false, id: uid()}));
      persistItems();
    }

    function currentListName(){ return state.lists.find(l=>l.id===state.currentListId)?.name || "Seznam"; }

    function groupByCategory(items){
      const map = new Map();
      for (const it of items){
        if (!map.has(it.category)) map.set(it.category, []);
        map.get(it.category).push(it);
      }
      return map;
    }

    function fillListSelect(){
      const sel = document.getElementById("listSel");
      sel.innerHTML = "";
      for (const l of state.lists){
        const opt = document.createElement("option");
        opt.value = l.id; opt.textContent = l.name;
        sel.appendChild(opt);
      }
      sel.value = state.currentListId;
      sel.onchange = () => {
        state.currentListId = sel.value;
        loadItemsForCurrent();
        renderAll();
      };
    }

    function fillPlanSelect(){
      const sel = document.getElementById("planSel");
      sel.innerHTML = "";
      for (const p of APP_DATA.plans){
        const opt = document.createElement("option");
        opt.value = p.id; opt.textContent = p.name;
        sel.appendChild(opt);
      }
      sel.value = state.currentPlanId;
      sel.onchange = () => {
        state.currentPlanId = sel.value;
        persistLists();
        loadSelectedForPlan();
        renderAll();
      };
    }

    function currentPlan(){ return APP_DATA.plans.find(p=>p.id===state.currentPlanId) || APP_DATA.plans[0]; }

    function loadSelectedForPlan(){
      state.selectedRecipes = new Set();
      const raw = localStorage.getItem(selectedKey(state.currentPlanId));
      if (raw){
        try { const arr = JSON.parse(raw); for (const id of arr) state.selectedRecipes.add(id); } catch {}
      } else {
        const plan = currentPlan();
        if (plan.id === "week1") for (const r of plan.recipes) state.selectedRecipes.add(r.id);
      }
    }

    function persistSelectedForPlan(){
      localStorage.setItem(selectedKey(state.currentPlanId), JSON.stringify([...state.selectedRecipes]));
    }

    function selectedRecipesObjects(){
      const plan = currentPlan();
      return plan.recipes.filter(r => state.selectedRecipes.has(r.id));
    }

    function planToShoppingFromRecipes(recipes){
      const seen = new Set();
      const out = [];
      for (const r of recipes){
        for (const ing of r.ingredients){
          const k = normalizeKey(ing.category) + "||" + normalizeKey(ing.name);
          if (!seen.has(k)){
            seen.add(k);
            out.push({category: ing.category, name: ing.name});
          }
        }
      }
      return out;
    }

    function applySelectedToList(mode){
      const recipes = selectedRecipesObjects();
      const shopping = planToShoppingFromRecipes(recipes);

      if (mode === "replace"){
        state.items = shopping.map(x => ({...x, done:false, id: uid()}));
      } else {
        const existing = new Set(state.items.map(it => normalizeKey(it.category)+"||"+normalizeKey(it.name)));
        for (const x of shopping){
          const k = normalizeKey(x.category)+"||"+normalizeKey(x.name);
          if (!existing.has(k)){
            state.items.unshift({...x, done:false, id: uid()});
            existing.add(k);
          }
        }
      }
      persistItems();
      setView("list");
      renderAll();
    }

    function renderList(){
      const q = (document.getElementById("q").value || "").trim().toLowerCase();
      let filtered = state.items.filter(it => it.name.toLowerCase().includes(q) || it.category.toLowerCase().includes(q));
      if (state.hideDone) filtered = filtered.filter(it => !it.done);

      const cards = document.getElementById("cards");
      cards.innerHTML = "";

      const grouped = groupByCategory(filtered);
      const cats = [...grouped.keys()].sort((a,b)=>a.localeCompare(b,'cs'));

      for (const cat of cats){
        const card = document.createElement("section");
        card.className = "card";
        const h = document.createElement("h3");
        h.textContent = cat;
        card.appendChild(h);

        const ul = document.createElement("ul");
        ul.className = "list";

        for (const it of grouped.get(cat)){
          const li = document.createElement("li");
          li.className = "item";

          const chk = document.createElement("button");
          chk.className = "chk" + (it.done ? " on" : "");
          chk.innerHTML = it.done ? "‚úì" : "";
          chk.onclick = () => { it.done = !it.done; persistItems(); renderAll(); };

          const label = document.createElement("div");
          label.className = "label" + (it.done ? " done" : "");
          label.textContent = it.name;

          const del = document.createElement("button");
          del.className = "x";
          del.title = "Smazat";
          del.textContent = "√ó";
          del.onclick = () => { state.items = state.items.filter(x => x.id !== it.id); persistItems(); renderAll(); };

          li.appendChild(chk);
          li.appendChild(label);
          li.appendChild(del);
          ul.appendChild(li);
        }

        card.appendChild(ul);
        cards.appendChild(card);
      }

      const done = state.items.filter(x=>x.done).length;
      const left = state.items.length - done;
      document.getElementById("countLine").textContent = `Seznam: ${currentListName()} ‚Ä¢ Hotovo: ${done} ‚Ä¢ Zb√Ωv√°: ${left}`;
      document.getElementById("hideDoneBtn").textContent = state.hideDone ? "üëÅ" : "üôà";
    }

    function renderPlan(){
      const plan = currentPlan();
      const box = document.getElementById("recipesBox");
      box.innerHTML = "";

      for (const r of plan.recipes){
        const div = document.createElement("div");
        div.className = "recipe";

        const head = document.createElement("div");
        head.className = "rhead";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.className = "rchk";
        cb.checked = state.selectedRecipes.has(r.id);
        cb.onchange = () => {
          if (cb.checked) state.selectedRecipes.add(r.id);
          else state.selectedRecipes.delete(r.id);
          persistSelectedForPlan();
        };

        const info = document.createElement("div");
        const title = document.createElement("div");
        title.style.fontWeight = "650";
        title.textContent = r.name;

        const meta = document.createElement("div");
        meta.className = "meta";
        meta.textContent = [r.time, r.servings].filter(Boolean).join(" ‚Ä¢ ");

        const ings = document.createElement("div");
        ings.className = "ingline";
        ings.textContent = r.ingredients.map(x => `${x.category}: ${x.name}`).join(" ‚Ä¢ ");

        const det = document.createElement("details");
        const sum = document.createElement("summary");
        sum.textContent = "Postup receptu";
        det.appendChild(sum);

        const ol = document.createElement("ol");
        for (const s of (r.steps || [])){
          const li = document.createElement("li");
          li.textContent = s;
          ol.appendChild(li);
        }
        det.appendChild(ol);

        if (r.tips){
          const tip = document.createElement("div");
          tip.className = "tiny";
          tip.style.marginTop = "6px";
          tip.textContent = "Tip: " + r.tips;
          det.appendChild(tip);
        }

        info.appendChild(title);
        info.appendChild(meta);
        info.appendChild(ings);
        info.appendChild(det);

        head.appendChild(cb);
        head.appendChild(info);

        div.appendChild(head);
        box.appendChild(div);
      }
    }

    function setView(v){
      state.view = v;
      document.getElementById("viewList").style.display = (v==="list") ? "" : "none";
      document.getElementById("viewPlan").style.display = (v==="plan") ? "" : "none";
      document.getElementById("tabList").classList.toggle("on", v==="list");
      document.getElementById("tabPlan").classList.toggle("on", v==="plan");
      if (v==="plan") renderPlan();
      if (v==="list") renderList();
    }

    function renderAll(){
      fillListSelect();
      fillPlanSelect();
      if (state.view === "plan") renderPlan();
      renderList();
    }

    function fillCategorySelect(){
      const sel = document.getElementById("newCat");
      const cats = [...new Set(state.items.map(x=>x.category))].sort((a,b)=>a.localeCompare(b,'cs'));
      sel.innerHTML = "";
      for (const c of cats){
        const opt = document.createElement("option");
        opt.value = c; opt.textContent = c;
        sel.appendChild(opt);
      }
      const optNew = document.createElement("option");
      optNew.value = "__new__";
      optNew.textContent = "‚ûï Nov√° kategorie‚Ä¶";
      sel.appendChild(optNew);

      if (cats.length) sel.value = cats[0];

      sel.onchange = () => {
        if (sel.value === "__new__"){
          const newCat = prompt("N√°zev nov√© kategorie:");
          if (newCat && newCat.trim()){
            const real = newCat.trim();
            const opt = document.createElement("option");
            opt.value = real; opt.textContent = real;
            sel.insertBefore(opt, sel.lastElementChild);
            sel.value = real;
          } else {
            sel.value = cats[0] || "Ostatn√≠";
          }
        }
      };
    }

    function openAdd(){
      fillCategorySelect();
      document.getElementById("newName").value = "";
      document.getElementById("dlgAdd").showModal();
      setTimeout(()=>document.getElementById("newName").focus(), 50);
    }

    function addItem(){
      const name = (document.getElementById("newName").value || "").trim();
      const cat = document.getElementById("newCat").value || "Ostatn√≠";
      if (!name) return;
      state.items.unshift({ id: uid(), name, category: cat, done:false });
      persistItems();
      document.getElementById("dlgAdd").close();
      renderAll();
    }

    async function shareList(){
      const lines = [];
      const grouped = groupByCategory(state.items.filter(x=>!x.done));
      const cats = [...grouped.keys()].sort((a,b)=>a.localeCompare(b,'cs'));
      for (const c of cats){
        lines.push(c + ":");
        for (const it of grouped.get(c)) lines.push(" - " + it.name);
        lines.push("");
      }
      const text = lines.join("\n").trim();
      if (navigator.share){
        try { await navigator.share({ title: "N√°kupn√≠ seznam", text }); return; } catch(e){}
      }
      try { await navigator.clipboard.writeText(text); alert("Zkop√≠rov√°no ‚úÖ"); }
      catch { prompt("Zkop√≠ruj:", text); }
    }

    function resetCurrent(){
      if (!confirm("Resetovat aktu√°ln√≠ seznam na v√Ωchoz√≠ polo≈æky?")) return;
      const meta = state.lists.find(l=>l.id===state.currentListId);
      const defaults = meta?.items || [];
      state.items = defaults.map(x => ({...x, done:false, id: uid()}));
      persistItems();
      renderAll();
    }

    function markAll(){
      const allDone = state.items.every(x=>x.done);
      for (const it of state.items) it.done = !allDone;
      persistItems();
      renderAll();
    }

    function renameList(){
      const meta = state.lists.find(l=>l.id===state.currentListId);
      if (!meta) return;
      const n = prompt("Nov√Ω n√°zev seznamu:", meta.name);
      if (!n || !n.trim()) return;
      meta.name = n.trim();
      persistLists();
      renderAll();
    }

    // Events
    document.getElementById("q").addEventListener("input", renderList);
    document.getElementById("tabList").addEventListener("click", ()=>setView("list"));
    document.getElementById("tabPlan").addEventListener("click", ()=>setView("plan"));

    document.getElementById("addBtn").addEventListener("click", openAdd);
    document.getElementById("saveBtn").addEventListener("click", addItem);
    document.getElementById("cancelBtn").addEventListener("click", ()=>document.getElementById("dlgAdd").close());
    document.getElementById("newName").addEventListener("keydown", (e)=>{ if (e.key==="Enter") addItem(); });

    const more = document.getElementById("dlgMore");
    const openMore = ()=>more.showModal();
    document.getElementById("moreBtn").addEventListener("click", openMore);
    document.getElementById("topMoreBtn").addEventListener("click", openMore);
    document.getElementById("closeMoreBtn").addEventListener("click", ()=>more.close());

    document.getElementById("hideDoneBtn").addEventListener("click", ()=>{ state.hideDone = !state.hideDone; persistLists(); renderAll(); });
    document.getElementById("markAllBtn").addEventListener("click", markAll);

    document.getElementById("renameBtn").addEventListener("click", ()=>{ more.close(); renameList(); });
    document.getElementById("shareBtn").addEventListener("click", ()=>{ more.close(); shareList(); });
    document.getElementById("printBtn").addEventListener("click", ()=>{ more.close(); window.print(); });
    document.getElementById("resetBtn").addEventListener("click", ()=>{ more.close(); resetCurrent(); });

    document.getElementById("genSelectedBtn").addEventListener("click", ()=>{
      if (!state.selectedRecipes.size) return alert("Vyber aspo≈à jedno j√≠dlo üôÇ");
      if (!confirm("P≈ôepsat aktu√°ln√≠ seznam podle vybran√Ωch j√≠del?")) return;
      applySelectedToList("replace");
    });
    document.getElementById("appendSelectedBtn").addEventListener("click", ()=>{
      if (!state.selectedRecipes.size) return alert("Vyber aspo≈à jedno j√≠dlo üôÇ");
      applySelectedToList("append");
    });

    // SW (v22)
    if ("serviceWorker" in navigator){
      window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js").catch(()=>{}));
    }

    // Init
    load();
    renderAll();
    setView("list");
  </script>
</body>
</html>
